

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>langchain.prompts.chat &mdash; ðŸ¦œðŸ”— LangChain 0.0.292</title>
  
  <link rel="canonical" href="https://api.python.langchain.com/en/latest/_modules/langchain/prompts/chat.html" />

  

  <link rel="stylesheet" href="../../../_static/css/vendor/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/autodoc_pydantic.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <link rel="stylesheet" href="/_/static/css/badge_only.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
<script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
<script src="../../../_static/jquery.js"></script> 

<!-- RTD Extra Head -->

<link rel="stylesheet" href="/_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/docs/api_reference", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "_modules/langchain/prompts/chat", "programming_language": "words", "project": "langchain", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "scikit-learn-modern", "user_analytics_code": "", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="/_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
<body>


<nav id="navbar" class="sk-docs-navbar navbar navbar-expand-md navbar-light bg-light py-0">
  <div class="container-fluid sk-docs-container px-0">
    <button
      id="sk-navbar-toggler"
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="sk-navbar-collapse collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../../api_reference.html">API</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../../experimental_api_reference.html">Experimental</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" target="_blank" rel="noopener noreferrer" href="https://python.langchain.com/">Python Docs</a>
        </li>
      </ul>
      <div id="searchbox" role="search">
          <div class="searchformwrapper">
          <form class="search" action="../../../search.html" method="get">
            <input class="sk-search-text-input" type="text" name="q" aria-labelledby="searchlabel" />
            <input class="sk-search-text-btn" type="submit" value="Go" />
          </form>
          </div>
      </div>
    </div>
  </div>
</nav>
<div class="d-flex" id="sk-doc-wrapper">
    <input type="checkbox" name="sk-toggle-checkbox" id="sk-toggle-checkbox">
    <label id="sk-sidemenu-toggle" class="sk-btn-toggle-toc btn sk-btn-primary" for="sk-toggle-checkbox">Toggle Menu</label>
    <div id="sk-sidebar-wrapper" class="border-right">
      <div class="sk-sidebar-toc-wrapper">
        <div class="btn-group w-100 mb-2" role="group" aria-label="rellinks">
            <a href="#" role="button" class="btn sk-btn-rellink py-1 disabled"">Prev</a><a href="../../index.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="Module code">Up</a>
            <a href="#" role="button" class="btn sk-btn-rellink py-1 disabled"">Next</a>
        </div>
        <div class="alert alert-warning p-1 mb-2" role="alert">
          <p class="text-center mb-0">
          <strong>LangChain 0.0.292</strong><br/>
          </p>
        </div>
            <div class="sk-sidebar-toc">
              
            </div>
      </div>
    </div>
    <div id="sk-page-content-wrapper">
      <div class="sk-page-content container-fluid body px-md-3" role="main">
        
  <h1>Source code for langchain.prompts.chat</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Chat prompt template.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">langchain._api</span> <span class="kn">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">langchain.load.serializable</span> <span class="kn">import</span> <span class="n">Serializable</span>
<span class="kn">from</span> <span class="nn">langchain.prompts.base</span> <span class="kn">import</span> <span class="n">StringPromptTemplate</span>
<span class="kn">from</span> <span class="nn">langchain.prompts.prompt</span> <span class="kn">import</span> <span class="n">PromptTemplate</span>
<span class="kn">from</span> <span class="nn">langchain.pydantic_v1</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">root_validator</span>
<span class="kn">from</span> <span class="nn">langchain.schema</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BasePromptTemplate</span><span class="p">,</span>
    <span class="n">PromptValue</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">langchain.schema.messages</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AIMessage</span><span class="p">,</span>
    <span class="n">BaseMessage</span><span class="p">,</span>
    <span class="n">ChatMessage</span><span class="p">,</span>
    <span class="n">HumanMessage</span><span class="p">,</span>
    <span class="n">SystemMessage</span><span class="p">,</span>
    <span class="n">get_buffer_string</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="BaseMessagePromptTemplate"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseMessagePromptTemplate.html#langchain.prompts.chat.BaseMessagePromptTemplate">[docs]</a><span class="k">class</span> <span class="nc">BaseMessagePromptTemplate</span><span class="p">(</span><span class="n">Serializable</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for message prompt templates.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lc_serializable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this object should be serialized.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether this object should be serialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="BaseMessagePromptTemplate.format_messages"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseMessagePromptTemplate.html#langchain.prompts.chat.BaseMessagePromptTemplate.format_messages">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">format_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format messages from kwargs. Should return a list of BaseMessages.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of BaseMessages.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">input_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Input variables for this prompt template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of input variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine two prompt templates.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Another prompt template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Combined prompt template.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">prompt</span> <span class="o">+</span> <span class="n">other</span></div>


<div class="viewcode-block" id="MessagesPlaceholder"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.MessagesPlaceholder.html#langchain.prompts.chat.MessagesPlaceholder">[docs]</a><span class="k">class</span> <span class="nc">MessagesPlaceholder</span><span class="p">(</span><span class="n">BaseMessagePromptTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prompt template that assumes variable is already list of messages.&quot;&quot;&quot;</span>

    <span class="n">variable_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of variable to use as messages.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MessagesPlaceholder.format_messages"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.MessagesPlaceholder.html#langchain.prompts.chat.MessagesPlaceholder.format_messages">[docs]</a>    <span class="k">def</span> <span class="nf">format_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format messages from kwargs.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of BaseMessage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;variable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> should be a list of base messages, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">BaseMessage</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;variable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> should be a list of base messages,&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; got </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Input variables for this prompt template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of input variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_name</span><span class="p">]</span></div>


<span class="n">MessagePromptTemplateT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span>
    <span class="s2">&quot;MessagePromptTemplateT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;BaseStringMessagePromptTemplate&quot;</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Type variable for message prompt templates.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="BaseStringMessagePromptTemplate"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseStringMessagePromptTemplate.html#langchain.prompts.chat.BaseStringMessagePromptTemplate">[docs]</a><span class="k">class</span> <span class="nc">BaseStringMessagePromptTemplate</span><span class="p">(</span><span class="n">BaseMessagePromptTemplate</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for message prompt templates that use a string prompt template.&quot;&quot;&quot;</span>

    <span class="n">prompt</span><span class="p">:</span> <span class="n">StringPromptTemplate</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;String prompt template.&quot;&quot;&quot;</span>
    <span class="n">additional_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Additional keyword arguments to pass to the prompt template.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="BaseStringMessagePromptTemplate.from_template"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseStringMessagePromptTemplate.html#langchain.prompts.chat.BaseStringMessagePromptTemplate.from_template">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_template</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">MessagePromptTemplateT</span><span class="p">],</span>
        <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">template_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f-string&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessagePromptTemplateT</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a class from a string template.</span>

<span class="sd">        Args:</span>
<span class="sd">            template: a template.</span>
<span class="sd">            template_format: format of the template.</span>
<span class="sd">            **kwargs: keyword arguments to pass to the constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new instance of this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_format</span><span class="o">=</span><span class="n">template_format</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseStringMessagePromptTemplate.from_template_file"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseStringMessagePromptTemplate.html#langchain.prompts.chat.BaseStringMessagePromptTemplate.from_template_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_template_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">MessagePromptTemplateT</span><span class="p">],</span>
        <span class="n">template_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">input_variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessagePromptTemplateT</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a class from a template file.</span>

<span class="sd">        Args:</span>
<span class="sd">            template_file: path to a template file. String or Path.</span>
<span class="sd">            input_variables: list of input variables.</span>
<span class="sd">            **kwargs: keyword arguments to pass to the constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new instance of this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">template_file</span><span class="p">,</span> <span class="n">input_variables</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseStringMessagePromptTemplate.format"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseStringMessagePromptTemplate.html#langchain.prompts.chat.BaseStringMessagePromptTemplate.format">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseMessage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the prompt template.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted message.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BaseStringMessagePromptTemplate.format_messages"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseStringMessagePromptTemplate.html#langchain.prompts.chat.BaseStringMessagePromptTemplate.format_messages">[docs]</a>    <span class="k">def</span> <span class="nf">format_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format messages from kwargs.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of BaseMessages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Input variables for this prompt template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of input variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="o">.</span><span class="n">input_variables</span></div>


<div class="viewcode-block" id="ChatMessagePromptTemplate"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatMessagePromptTemplate.html#langchain.prompts.chat.ChatMessagePromptTemplate">[docs]</a><span class="k">class</span> <span class="nc">ChatMessagePromptTemplate</span><span class="p">(</span><span class="n">BaseStringMessagePromptTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chat message prompt template.&quot;&quot;&quot;</span>

    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Role of the message.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ChatMessagePromptTemplate.format"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatMessagePromptTemplate.html#langchain.prompts.chat.ChatMessagePromptTemplate.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseMessage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the prompt template.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ChatMessage</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_kwargs</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="HumanMessagePromptTemplate"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.HumanMessagePromptTemplate.html#langchain.prompts.chat.HumanMessagePromptTemplate">[docs]</a><span class="k">class</span> <span class="nc">HumanMessagePromptTemplate</span><span class="p">(</span><span class="n">BaseStringMessagePromptTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Human message prompt template. This is a message sent from the user.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HumanMessagePromptTemplate.format"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.HumanMessagePromptTemplate.html#langchain.prompts.chat.HumanMessagePromptTemplate.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseMessage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the prompt template.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AIMessagePromptTemplate"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.AIMessagePromptTemplate.html#langchain.prompts.chat.AIMessagePromptTemplate">[docs]</a><span class="k">class</span> <span class="nc">AIMessagePromptTemplate</span><span class="p">(</span><span class="n">BaseStringMessagePromptTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AI message prompt template. This is a message sent from the AI.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AIMessagePromptTemplate.format"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.AIMessagePromptTemplate.html#langchain.prompts.chat.AIMessagePromptTemplate.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseMessage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the prompt template.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SystemMessagePromptTemplate"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.SystemMessagePromptTemplate.html#langchain.prompts.chat.SystemMessagePromptTemplate">[docs]</a><span class="k">class</span> <span class="nc">SystemMessagePromptTemplate</span><span class="p">(</span><span class="n">BaseStringMessagePromptTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;System message prompt template.</span>
<span class="sd">    This is a message that is not sent to the user.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SystemMessagePromptTemplate.format"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.SystemMessagePromptTemplate.html#langchain.prompts.chat.SystemMessagePromptTemplate.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseMessage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the prompt template.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formatted message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SystemMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">additional_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ChatPromptValue"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptValue.html#langchain.prompts.chat.ChatPromptValue">[docs]</a><span class="k">class</span> <span class="nc">ChatPromptValue</span><span class="p">(</span><span class="n">PromptValue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chat prompt value.</span>

<span class="sd">    A type of a prompt value that is built from messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of messages.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ChatPromptValue.to_string"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptValue.html#langchain.prompts.chat.ChatPromptValue.to_string">[docs]</a>    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return prompt as string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_buffer_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChatPromptValue.to_messages"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptValue.html#langchain.prompts.chat.ChatPromptValue.to_messages">[docs]</a>    <span class="k">def</span> <span class="nf">to_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return prompt as a list of messages.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span></div></div>


<div class="viewcode-block" id="BaseChatPromptTemplate"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseChatPromptTemplate.html#langchain.prompts.chat.BaseChatPromptTemplate">[docs]</a><span class="k">class</span> <span class="nc">BaseChatPromptTemplate</span><span class="p">(</span><span class="n">BasePromptTemplate</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for chat prompt templates.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lc_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of attribute names that should be included in the</span>
<span class="sd">        serialized kwargs. These attributes must be accepted by the</span>
<span class="sd">        constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;input_variables&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span><span class="p">}</span>

<div class="viewcode-block" id="BaseChatPromptTemplate.format"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseChatPromptTemplate.html#langchain.prompts.chat.BaseChatPromptTemplate.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the chat template into a string.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: keyword arguments to use for filling in template variables</span>
<span class="sd">                      in all the template messages in this chat template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            formatted string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_prompt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span></div>

<div class="viewcode-block" id="BaseChatPromptTemplate.format_prompt"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseChatPromptTemplate.html#langchain.prompts.chat.BaseChatPromptTemplate.format_prompt">[docs]</a>    <span class="k">def</span> <span class="nf">format_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptValue</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format prompt. Should return a PromptValue.</span>
<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to use for formatting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PromptValue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ChatPromptValue</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseChatPromptTemplate.format_messages"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.BaseChatPromptTemplate.html#langchain.prompts.chat.BaseChatPromptTemplate.format_messages">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">format_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format kwargs into a list of messages.&quot;&quot;&quot;</span></div></div>


<span class="n">MessageLike</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">BaseMessagePromptTemplate</span><span class="p">,</span> <span class="n">BaseMessage</span><span class="p">,</span> <span class="n">BaseChatPromptTemplate</span><span class="p">]</span>

<span class="n">MessageLikeRepresentation</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">MessageLike</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="nb">str</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="ChatPromptTemplate"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate">[docs]</a><span class="k">class</span> <span class="nc">ChatPromptTemplate</span><span class="p">(</span><span class="n">BaseChatPromptTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A prompt template for chat models.</span>

<span class="sd">    Use to create flexible templated prompts for chat models.</span>

<span class="sd">    Examples:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from langchain.prompts import ChatPromptTemplate</span>

<span class="sd">            template = ChatPromptTemplate.from_messages([</span>
<span class="sd">                (&quot;system&quot;, &quot;You are a helpful AI bot. Your name is {name}.&quot;),</span>
<span class="sd">                (&quot;human&quot;, &quot;Hello, how are you doing?&quot;),</span>
<span class="sd">                (&quot;ai&quot;, &quot;I&#39;m doing well, thanks!&quot;),</span>
<span class="sd">                (&quot;human&quot;, &quot;{user_input}&quot;),</span>
<span class="sd">            ])</span>

<span class="sd">            messages = template.format_messages(</span>
<span class="sd">                name=&quot;Bob&quot;,</span>
<span class="sd">                user_input=&quot;What is your name?&quot;</span>
<span class="sd">            )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">input_variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of input variables in template messages. Used for validation.&quot;&quot;&quot;</span>
    <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MessageLike</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of messages consisting of either message prompt templates or messages.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine two prompt templates.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Another prompt template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Combined prompt template.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Allow for easy combining</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ChatPromptTemplate</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">BaseMessagePromptTemplate</span><span class="p">,</span> <span class="n">BaseMessage</span><span class="p">,</span> <span class="n">BaseChatPromptTemplate</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">+</span> <span class="p">[</span><span class="n">other</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">_other</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">+</span> <span class="n">_other</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">HumanMessagePromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">+</span> <span class="p">[</span><span class="n">prompt</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported operand type for +: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_input_variables</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate input variables.</span>

<span class="sd">        If input_variables is not set, it will be set to the union of</span>
<span class="sd">        all input variables in the messages.</span>

<span class="sd">        Args:</span>
<span class="sd">            values: values to validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Validated values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>
        <span class="n">input_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">BaseMessagePromptTemplate</span><span class="p">,</span> <span class="n">BaseChatPromptTemplate</span><span class="p">)):</span>
                <span class="n">input_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">input_variables</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;partial_variables&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">input_vars</span> <span class="o">=</span> <span class="n">input_vars</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;partial_variables&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;input_variables&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input_vars</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;input_variables&quot;</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Got mismatched input_variables. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected: </span><span class="si">{</span><span class="n">input_vars</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Got: </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;input_variables&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;input_variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">input_vars</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

<div class="viewcode-block" id="ChatPromptTemplate.from_template"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.from_template">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_template</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a chat prompt template from a template string.</span>

<span class="sd">        Creates a chat template consisting of a single message assumed to be from</span>
<span class="sd">        the human.</span>

<span class="sd">        Args:</span>
<span class="sd">            template: template string</span>
<span class="sd">            **kwargs: keyword arguments to pass to the constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new instance of this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">HumanMessagePromptTemplate</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt_template</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_messages</span><span class="p">([</span><span class="n">message</span><span class="p">])</span></div>

<div class="viewcode-block" id="ChatPromptTemplate.from_role_strings"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.from_role_strings">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;0.0.260&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;from_messages classmethod&quot;</span><span class="p">,</span> <span class="n">pending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_role_strings</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">string_messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a chat prompt template from a list of (role, template) tuples.</span>

<span class="sd">        Args:</span>
<span class="sd">            string_messages: list of (role, template) tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">            a chat prompt template</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ChatMessagePromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">role</span><span class="p">,</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">string_messages</span>
            <span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ChatPromptTemplate.from_strings"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.from_strings">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;0.0.260&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;from_messages classmethod&quot;</span><span class="p">,</span> <span class="n">pending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_strings</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">string_messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseMessagePromptTemplate</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a chat prompt template from a list of (role class, template) tuples.</span>

<span class="sd">        Args:</span>
<span class="sd">            string_messages: list of (role class, template) tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">            a chat prompt template</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">string_messages</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChatPromptTemplate.from_messages"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.from_messages">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_messages</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">messages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">MessageLikeRepresentation</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a chat prompt template from a variety of message formats.</span>

<span class="sd">        Examples:</span>

<span class="sd">            Instantiation from a list of message templates:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                template = ChatPromptTemplate.from_messages([</span>
<span class="sd">                    (&quot;human&quot;, &quot;Hello, how are you?&quot;),</span>
<span class="sd">                    (&quot;ai&quot;, &quot;I&#39;m doing well, thanks!&quot;),</span>
<span class="sd">                    (&quot;human&quot;, &quot;That&#39;s good to hear.&quot;),</span>
<span class="sd">                ])</span>

<span class="sd">            Instantiation from mixed message formats:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                template = ChatPromptTemplate.from_messages([</span>
<span class="sd">                    SystemMessage(content=&quot;hello&quot;),</span>
<span class="sd">                    (&quot;human&quot;, &quot;Hello, how are you?&quot;),</span>
<span class="sd">                ])</span>

<span class="sd">        Args:</span>
<span class="sd">            messages: sequence of message representations.</span>
<span class="sd">                  A message can be represented using the following formats:</span>
<span class="sd">                  (1) BaseMessagePromptTemplate, (2) BaseMessage, (3) 2-tuple of</span>
<span class="sd">                  (message type, template); e.g., (&quot;human&quot;, &quot;{user_input}&quot;),</span>
<span class="sd">                  (4) 2-tuple of (message class, template), (4) a string which is</span>
<span class="sd">                  shorthand for (&quot;human&quot;, template); e.g., &quot;{user_input}&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            a chat prompt template</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">_convert_to_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]</span>

        <span class="c1"># Automatically infer input variables from messages</span>
        <span class="n">input_vars</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_message</span> <span class="ow">in</span> <span class="n">_messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">_message</span><span class="p">,</span> <span class="p">(</span><span class="n">BaseChatPromptTemplate</span><span class="p">,</span> <span class="n">BaseMessagePromptTemplate</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">input_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_message</span><span class="o">.</span><span class="n">input_variables</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">input_variables</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">input_vars</span><span class="p">),</span> <span class="n">messages</span><span class="o">=</span><span class="n">_messages</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChatPromptTemplate.format"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the chat template into a string.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: keyword arguments to use for filling in template variables</span>
<span class="sd">                      in all the template messages in this chat template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            formatted string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_prompt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span></div>

<div class="viewcode-block" id="ChatPromptTemplate.format_messages"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.format_messages">[docs]</a>    <span class="k">def</span> <span class="nf">format_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the chat template into a list of finalized messages.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: keyword arguments to use for filling in template variables</span>
<span class="sd">                      in all the template messages in this chat template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of formatted messages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_partial_and_user_variables</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">message_template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message_template</span><span class="p">,</span> <span class="n">BaseMessage</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">message_template</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">message_template</span><span class="p">,</span> <span class="p">(</span><span class="n">BaseMessagePromptTemplate</span><span class="p">,</span> <span class="n">BaseChatPromptTemplate</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">rel_params</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">message_template</span><span class="o">.</span><span class="n">input_variables</span>
                <span class="p">}</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">message_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="o">**</span><span class="n">rel_params</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected input: </span><span class="si">{</span><span class="n">message_template</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="ChatPromptTemplate.partial"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.partial">[docs]</a>    <span class="k">def</span> <span class="nf">partial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a new ChatPromptTemplate with some input variables already filled in.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: keyword arguments to use for filling in template variables. Ought</span>
<span class="sd">                        to be a subset of the input variables.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ChatPromptTemplate.</span>


<span class="sd">        Example:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from langchain.prompts import ChatPromptTemplate</span>

<span class="sd">                template = ChatPromptTemplate.from_messages(</span>
<span class="sd">                    [</span>
<span class="sd">                        (&quot;system&quot;, &quot;You are an AI assistant named {name}.&quot;),</span>
<span class="sd">                        (&quot;human&quot;, &quot;Hi I&#39;m {user}&quot;),</span>
<span class="sd">                        (&quot;ai&quot;, &quot;Hi there, {user}, I&#39;m {name}.&quot;),</span>
<span class="sd">                        (&quot;human&quot;, &quot;{input}&quot;),</span>
<span class="sd">                    ]</span>
<span class="sd">                )</span>
<span class="sd">                template2 = template.partial(user=&quot;Lucy&quot;, name=&quot;R2D2&quot;)</span>

<span class="sd">                template2.format_messages(input=&quot;hello&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">prompt_dict</span><span class="p">[</span><span class="s2">&quot;input_variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">prompt_dict</span><span class="p">[</span><span class="s2">&quot;partial_variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">partial_variables</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="o">**</span><span class="n">prompt_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChatPromptTemplate.append"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">MessageLikeRepresentation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Append message to the end of the chat template.</span>

<span class="sd">        Args:</span>
<span class="sd">            message: representation of a message to append.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_convert_to_message</span><span class="p">(</span><span class="n">message</span><span class="p">))</span></div>

<div class="viewcode-block" id="ChatPromptTemplate.extend"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">MessageLikeRepresentation</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend the chat template with a sequence of messages.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_convert_to_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">])</span></div>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessageLike</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">MessageLike</span><span class="p">,</span> <span class="n">ChatPromptTemplate</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use to index into the chat template.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">))</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">:</span><span class="n">step</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the length of the chat template.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_prompt_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of prompt type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;chat&quot;</span>

<div class="viewcode-block" id="ChatPromptTemplate.save"><a class="viewcode-back" href="../../../prompts/langchain.prompts.chat.ChatPromptTemplate.html#langchain.prompts.chat.ChatPromptTemplate.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save prompt to file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: path to file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>


<span class="k">def</span> <span class="nf">_create_template_from_message_type</span><span class="p">(</span>
    <span class="n">message_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseMessagePromptTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a message prompt template from a message type and template string.</span>

<span class="sd">    Args:</span>
<span class="sd">        message_type: str the type of the message template (e.g., &quot;human&quot;, &quot;ai&quot;, etc.)</span>
<span class="sd">        template: str the template string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a message prompt template of the appropriate type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">message_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">):</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">BaseMessagePromptTemplate</span> <span class="o">=</span> <span class="n">HumanMessagePromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">template</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">message_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ai&quot;</span><span class="p">,</span> <span class="s2">&quot;assistant&quot;</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">AIMessagePromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="s2">&quot;system&quot;</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">SystemMessagePromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected message type: </span><span class="si">{</span><span class="n">message_type</span><span class="si">}</span><span class="s2">. Use one of &#39;human&#39;,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; &#39;user&#39;, &#39;ai&#39;, &#39;assistant&#39;, or &#39;system&#39;.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">message</span>


<span class="k">def</span> <span class="nf">_convert_to_message</span><span class="p">(</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">MessageLikeRepresentation</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">,</span> <span class="n">BaseMessagePromptTemplate</span><span class="p">,</span> <span class="n">BaseChatPromptTemplate</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instantiate a message from a variety of message formats.</span>

<span class="sd">    The message format can be one of the following:</span>

<span class="sd">    - BaseMessagePromptTemplate</span>
<span class="sd">    - BaseMessage</span>
<span class="sd">    - 2-tuple of (role string, template); e.g., (&quot;human&quot;, &quot;{user_input}&quot;)</span>
<span class="sd">    - 2-tuple of (message class, template)</span>
<span class="sd">    - string: shorthand for (&quot;human&quot;, template); e.g., &quot;{user_input}&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        message: a representation of a message in one of the supported formats</span>

<span class="sd">    Returns:</span>
<span class="sd">        an instance of a message or a message template</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">BaseMessagePromptTemplate</span><span class="p">,</span> <span class="n">BaseChatPromptTemplate</span><span class="p">)):</span>
        <span class="n">_message</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">BaseMessage</span><span class="p">,</span> <span class="n">BaseMessagePromptTemplate</span><span class="p">,</span> <span class="n">BaseChatPromptTemplate</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">BaseMessage</span><span class="p">):</span>
        <span class="n">_message</span> <span class="o">=</span> <span class="n">message</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">_message</span> <span class="o">=</span> <span class="n">_create_template_from_message_type</span><span class="p">(</span><span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected 2-tuple of (role, template), got </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">message_type_str</span><span class="p">,</span> <span class="n">template</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message_type_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_message</span> <span class="o">=</span> <span class="n">_create_template_from_message_type</span><span class="p">(</span><span class="n">message_type_str</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_message</span> <span class="o">=</span> <span class="n">message_type_str</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">template</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported message type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_message</span>
</pre></div>

      </div>
    <div class="container">
      <footer class="sk-content-footer">
            &copy; 2023, Harrison Chase.
          Last updated on Sep 17, 2023.
      </footer>
    </div>
  </div>
</div>
<script src="../../../_static/js/vendor/bootstrap.min.js"></script>
<script>
$(document).ready(function() {
    /* Add a [>>>] button on the top-right corner of code samples to hide
     * the >>> and ... prompts and the output and thus make the code
     * copyable. */
    var div = $('.highlight-python .highlight,' +
                '.highlight-python3 .highlight,' +
                '.highlight-pycon .highlight,' +
		'.highlight-default .highlight')
    var pre = div.find('pre');

    // get the styles from the current theme
    pre.parent().parent().css('position', 'relative');
    var hide_text = 'Hide prompts and outputs';
    var show_text = 'Show prompts and outputs';

    // create and add the button to all the code blocks that contain >>>
    div.each(function(index) {
        var jthis = $(this);
        if (jthis.find('.gp').length > 0) {
            var button = $('<span class="copybutton">&gt;&gt;&gt;</span>');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
            jthis.prepend(button);
        }
        // tracebacks (.gt) contain bare text elements that need to be
        // wrapped in a span to work with .nextUntil() (see later)
        jthis.find('pre:has(.gt)').contents().filter(function() {
            return ((this.nodeType == 3) && (this.data.trim().length > 0));
        }).wrap('<span>');
    });

    // define the behavior of the button when it's clicked
    $('.copybutton').click(function(e){
        e.preventDefault();
        var button = $(this);
        if (button.data('hidden') === 'false') {
            // hide the code output
            button.parent().find('.go, .gp, .gt').hide();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'hidden');
            button.css('text-decoration', 'line-through');
            button.attr('title', show_text);
            button.data('hidden', 'true');
        } else {
            // show the code output
            button.parent().find('.go, .gp, .gt').show();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'visible');
            button.css('text-decoration', 'none');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
        }
    });

	/*** Add permalink buttons next to glossary terms ***/
	$('dl.glossary > dt[id]').append(function() {
		return ('<a class="headerlink" href="#' +
			    this.getAttribute('id') +
			    '" title="Permalink to this term">Â¶</a>');
	});
});

</script>
    
</body>
</html>